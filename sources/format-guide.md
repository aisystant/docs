# Руководство по форматированию Markdown

Этот файл служит шаблоном и руководством для конвертации Word-документов в формат Markdown.

## Структура документа

### Заголовки

Используйте стандартную иерархию заголовков:

```markdown
# Название раздела (H1) - для названия раздела или подраздела
## Подраздел (H2) - для основных подразделов
### Детальный подраздел (H3) - для более детальных подразделов
#### Ещё более детальный подраздел (H4) - при необходимости
```

**Важно:**
- Заголовок первого уровня (H1) в начале файла считается парсером как название раздела или подраздела (без нумерации). Если заголовка первого уровня нет, название берётся из имени папки или файла.
- Далее ограничений на заголовки нет, но в Word заголовки 1 и 2 уровней использовались только для разделов или подразделов, то есть просто в тексте таких заголовков не было.

### Текстовое форматирование

- **Жирный текст** для важных терминов и понятий: `**текст**`
- *Курсив* для акцентов и иностранных слов: `*текст*`
- `Моноширинный текст` для кода и команд: `` `текст` ``

### Списки

**Маркированный список:**
- Пункт 1
- Пункт 2
  - Подпункт 2.1
  - Подпункт 2.2
- Пункт 3

**Нумерованный список:**
1. Первый пункт
2. Второй пункт
3. Третий пункт

### Ссылки

Внутренние ссылки: `[текст ссылки](относительный/путь/к/файлу.md)`

Внешние ссылки: `[текст ссылки](https://example.com)`

### Изображения

Изображения сохраняются в папку `assets` на уровне секции (не подраздела):

```markdown
![Описание изображения](assets/fig-01-description.png)

*Рис. X.X. Подпись к изображению*
```

**Важно:** Между изображением и подписью должна быть **пустая строка**, чтобы подпись корректно отображалась как отдельный абзац.

**Формат имён файлов изображений:** `fig-XX-description.ext`
- `fig-` — обязательный префикс
- `XX` — порядковый номер (01, 02, 03...)
- `description` — краткое описание в kebab-case
- Примеры: `fig-01-mental-space.jpg`, `fig-02-system-levels.png`

**Подпись к изображению:** После изображения обязательно добавляется курсивная подпись:
```markdown
*Рис. X.X. Описание рисунка*
```
где `X.X` соответствует номеру раздела (например, `Рис. 1.1.`, `Рис. 2.3.`)

### Сноски (footnotes)

Сноски оформляются в стандартном формате Markdown:

**Ссылка в тексте:**
```markdown
Системное мышление[^1] — это метод...
```

**Определение сноски** (в конце файла, после основного текста):
```markdown
[^1]: Левенчук А.И. «Системное мышление», 2024.
```

**Правила:**
- Ссылка в тексте: `[^N]` — где N это порядковый номер
- Определение: `[^N]: текст` — в конце файла, после основного контента
- Между основным текстом и блоком сносок — **одна пустая строка**
- Многострочные сноски: продолжение с отступом 4 пробела
- Каждый файл содержит **только те определения сносок, на которые есть ссылки** в его тексте
- Нумерация сносок сквозная по всему курсу (из исходного Word-документа)

**Пример в файле:**
```markdown
---
title: "Название подраздела"
order: 1
type: text
---


# Название подраздела

Системное мышление[^1] помогает разобраться в сложных ситуациях.
Это подтверждается исследованиями[^2].

Далее идёт текст подраздела...

[^1]: Левенчук А.И. «Системное мышление», 2024.

[^2]: ISO/IEC/IEEE 15288:2023, Systems and software engineering.
```

**При конвертации из Word:** Скрипт автоматически извлекает все определения сносок из pandoc-вывода (где они собраны в конце) и распределяет по файлам — каждый файл получает только свои сноски.

### Цитаты

> Это блок цитаты.
> Используется для выделения важных мыслей или цитат из источников.

### Таблицы

Используется **только pipe-формат** (стандартный Markdown):

```markdown
| Заголовок 1 | Заголовок 2 | Заголовок 3 |
|-------------|-------------|-------------|
| Ячейка 1.1  | Ячейка 1.2  | Ячейка 1.3  |
| Ячейка 2.1  | Ячейка 2.2  | Ячейка 2.3  |
```

**Важно:** Pandoc при конвертации из Word может генерировать два нестандартных формата таблиц:
- **Grid-таблицы** (`+---+---+`) — для сложных таблиц с многострочными ячейками
- **Simple-таблицы** (строки из тире с пробелами) — для простых таблиц

Оба формата не рендерятся большинством Markdown-движков. Скрипт `convert.py` автоматически конвертирует их в pipe-формат. Для ручного исправления:

```bash
python3 scripts/convert_word/fix_grid_tables.py <файл или директория>
python3 scripts/convert_word/fix_simple_tables.py <файл или директория>
```

### Блоки кода

Для однострочного кода используйте обратные кавычки: `код`

Для многострочных блоков кода:

```python
def example_function():
    print("Hello, World!")
    return True
```

### Специальные блоки

**Примечание:**
```markdown
> **Примечание:** Важная информация, которую нужно выделить.
```

**Предупреждение:**
```markdown
> **Предупреждение:** Критически важная информация.
```

## Правила конвертации из Word

### 1. Заголовки
- Заголовок 1 (Word) → `#` (H1) — название документа
- Заголовок 2 (Word) → `##` (H2) — основные подразделы
- Заголовок 3 (Word) → `###` (H3) — детальные подразделы
- Заголовок 4 (Word) → `####` (H4) — при необходимости

### 2. Форматирование текста
- Полужирный (Word) → `**текст**`
- Курсив (Word) → `*текст*`
- Подчеркнутый → использовать `**текст**` или игнорировать

### 3. Списки
- Маркированные списки сохраняются с `-`
- Нумерованные списки сохраняются с цифрами
- Вложенность передается через отступы (2 пробела)

### 4. Изображения
- Извлечь все изображения из Word-документа
- Сохранить в папку `assets` секции с именами в формате `fig-XX-description.ext`
- Вставить ссылки и подписи (с пустой строкой между изображением и подписью):
  ```markdown
  ![Описание](assets/fig-01-description.png)

  *Рис. X.X. Подпись к рисунку*
  ```

### 5. Таблицы
- Используется только pipe-формат (`| --- |`), НЕ grid-формат (`+---+`) или simple-формат Pandoc (строки из тире)
- `convert.py` автоматически конвертирует grid и simple → pipe при конвертации из Word
- Для исправления существующих файлов:
  - Grid-таблицы: `python3 fix_grid_tables.py <путь>`
  - Simple-таблицы: `python3 fix_simple_tables.py <путь>`
- Многострочные ячейки из Word объединяются в одну строку (ограничение pipe-таблиц)
- Объединённые строки (row spans) из Word превращаются в отдельные строки с пустыми ячейками

### 6. Гиперссылки
- Сохранить текст ссылки и URL
- Формат: `[текст](URL)`

### 7. Сноски
- Pandoc собирает все определения сносок в конец документа
- Скрипт автоматически распределяет определения `[^N]: текст` по файлам, где есть ссылки `[^N]`
- Нумерация сохраняется сквозная из Word-документа
- Многострочные сноски (с отступом 4 пробела) поддерживаются

### 8. Специальные символы
- Экранировать специальные символы при необходимости: `\*`, `\[`, `\]`

## Структура файлов

```
docs/
├── ru/
│   └── personal/
│       └── 1-1-self-development/
│           ├── 00-intro/
│           │   ├── index.md
│           │   └── 01-about.md
│           ├── 01-physical-world/
│           │   ├── index.md
│           │   ├── 01-mental-space.md
│           │   ├── 02-theory-models.md
│           │   ├── ...
│           │   ├── 11-summary.md
│           │   ├── 12-concepts.md      # Моделирование: понятия
│           │   ├── 13-review.md        # Вопросы для повторения
│           │   ├── 14-homework.md      # Домашнее задание
│           │   └── assets/
│           │       ├── fig-01-mental-space.jpg
│           │       ├── fig-02-scientific-models.png
│           │       └── fig-03-world-descriptions.png
│           └── 02-learning-time/
│               ├── index.md
│               ├── 01-learning.md
│               └── assets/
│                   ├── fig-01-learning-process.png
│                   └── fig-02-social-learning.png
sources/
├── word-files/                          ← исходные .docx файлы
│   └── document.docx
├── 1-3-systems-thinking-introduction/   ← пример результата конвертации
├── format-guide.md                      ← правила форматирования (этот файл)
└── README.md                            ← инструкция по конвертации
```

**Важно:** Папка `assets` располагается на уровне секции (например, `01-physical-world/assets/`), а не внутри каждого подраздела.

## Типы подразделов

Контент делится на различные типы в зависимости от назначения:

| Тип (type) | Названия разделов | Паттерны файлов |
|------------|-------------------|-----------------|
| `text` | Конкретные названия разделов | Обычные `.md` файлы |
| `table` | Моделирование, Моделирование: понятия | `*-concepts.md`, `*-modeling-*.md` |
| `checklist` | Вопросы для повторения, Домашнее задание, Задания | `*-review.md`, `*-homework.md`, `*-checklist-*.md`, `*-tasks.md` |
| `multiple_choice` | Задачи, Вопросы | `*-questions-*.md`, `*-problems-*.md` |

**Именование файлов:**
- `XX-` — порядковый номер внутри раздела (определяет позицию)
- Суффикс указывает на тип практического подраздела. Если название раздела или подраздела указано не в заголовке (H1), суффикс не обязателен.

**Примечание:** В перспективе рекомендуется перейти на указание типа подраздела в Front Matter вместо использования суффиксов и префиксов в именах файлов.

**Примеры:**
```
05-modeling-roles.md      → Моделирование: роли       (table)
08-problems-systems.md    → Задачи: системы           (multiple_choice)
12-concepts.md            → Моделирование: понятия   (table)
13-review.md              → Вопросы для повторения   (checklist)
14-homework.md            → Домашнее задание         (checklist)
```

## YAML Front Matter для текстовых файлов

Каждый файл текстового контента (`.md`) должен содержать метаданные в начале:

```yaml
---
id: "1.1.01.01"
type: text
title: "Название раздела"
order: 1
---


# Название раздела
```

**Важно:** После закрывающего `---` должны быть **две пустые строки** перед заголовком H1.

**Обязательные поля:**
- `id` — уникальный идентификатор в формате `"X.X.XX.XX"`
- `type` — тип контента (см. таблицу типов выше)
- `title` — название раздела
- `order` — порядок отображения в секции

**Опциональные поля:**
- `reading_time` — время чтения в минутах
- `images` — список используемых изображений
- `concepts` — список основных понятий раздела

## Файлы с заданиями множественного выбора

Файлы заданий множественного выбора имеют расширение `.md`, но содержат специальную структуру YAML Front Matter с описанием теста. Содержимое YAML используется парсером для загрузки в LMS.

**Структура файла:**

```markdown
---
id: "1.1.01.02"
type: multiple_choice
title: "Задачи"
order: 2
cases:
  - question_text: "Текст вопроса1"
    options:
      - text: "Вариант ответа 1"
        correct: false
        explanation: "Пояснение к ответу"
      - text: "Вариант ответа 2"
        correct: true
        explanation: "Пояснение к ответу"
      - text: "Вариант ответа 3"
        correct: false
        explanation: "Пояснение к ответу"
  - question_text: "Текст вопроса2"
    options:
      - text: "Вариант ответа 1"
        correct: false
        explanation: "Пояснение к ответу"
      - text: "Вариант ответа 2"
        correct: true
        explanation: "Пояснение к ответу"
---

# Задачи: Название теста

Текст вопроса1
1. Вариант ответа 1
2. Вариант ответа 2
3. Вариант ответа 3

Текст вопроса2
1. Вариант ответа 1
2. Вариант ответа 2
```

**Важно:**
- Файл имеет расширение `.md`
- YAML Front Matter выделяется тремя дефисами `---` до и после блока метаданных
- После закрывающего `---` следует текст с названием задания — именно этот текст будет отображаться в открытом доступе на https://docs.system-school.ru/
- Содержимое YAML (вопрос, варианты ответов, пояснение) забирается парсером для LMS и не отображается публично. Публично отображается то, что добавлено после заголовка (в примере выше это то, что после текста "Задачи: Название теста")

**Поля multiple_choice:**
- `question` — текст вопроса
- `options` — массив вариантов ответа, каждый содержит `text` и `correct` (true/false)
- `explanation` — пояснение к правильному ответу (опционально)

## Интеграция с Aisystant

При подготовке курсов для платформы Aisystant необходимо указывать специальный код интеграции.

### Обязательное поле aisystant_code

Поле `aisystant_code` добавляется **только в корневой `index.md` курса** (не в разделы и не в подразделы).

```yaml
---
title: "Введение в системное мышление"
order: 0
aisystant_code: "SM2024-01"
---


# Введение в системное мышление
```

**Правила:**
- Поле `aisystant_code` указывается **только в корневом `index.md` курса** — один код на весь курс
- В `index.md` разделов и в файлах подразделов поле `aisystant_code` **не указывается**
- Код **обязательно запросить у автора** исходного материала **до конвертации**
- Скрипт конвертации не запустится без указания `--aisystant-code`
- Без указания `aisystant_code` курс не будет корректно привязан к платформе Aisystant
- Код выдается администратором платформы

## Контрольный список при конвертации

- [ ] В корневом index.md курса указан `aisystant_code`
- [ ] Все заголовки правильно отформатированы
- [ ] Жирный текст и курсив конвертированы
- [ ] Списки правильно структурированы
- [ ] Все изображения извлечены и размещены
- [ ] Ссылки работают корректно
- [ ] Таблицы в pipe-формате (`| --- |`), нет grid-таблиц (`+---+`) и simple-таблиц Pandoc (строки из тире)
- [ ] Специальные символы экранированы
- [ ] Сноски распределены по файлам (каждый файл содержит только свои определения)
- [ ] Файл проходит проверку Markdown-линтером
- [ ] Относительные пути к файлам корректны

## Примечания

- Сохраняйте структуру и логику исходного документа
- Используйте понятные имена файлов (kebab-case)
- **Не используйте точки в названиях папок и файлов** — вместо точек используйте тире (например, `1-1-self-development` вместо `1.1-self-development`)
- Группируйте связанные материалы в папки
- Добавляйте `index.md` для каждой секции
